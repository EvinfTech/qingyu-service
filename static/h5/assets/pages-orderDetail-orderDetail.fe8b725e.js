import{p as e,s as t,J as a,G as l,H as s,O as n,B as i,D as o,o as r,c,w as f,i as d,b as u,g as p,l as m,t as h,e as _,x as g,F as y,n as x,r as b,z as w,h as T,S as k}from"./index-0cdf8aad.js";import{r as C,_ as L}from"./uni-app.es.b79b333a.js";import{_ as j}from"./u-navbar.c8086c10.js";import{_ as I}from"./u-modal.9ca63db5.js";import{r as S}from"./request.4f472fa9.js";import{_ as v}from"./wechatIcon.9c8d4b5a.js";import{_ as B}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.a67cb4cf.js";import"./u-safe-bottom.196165c8.js";const P=""+new URL("timeLine-5883386b.svg",import.meta.url).href;const N=B({data:()=>({app:e(),order_no:"",detailType:"",gymnasiumInfo:{name:"",phone:"",location:"",latitude:"",longitude:""},show:!1,sessionList:[],orderTime:"",payTime:"",totalPrice:0,payState:"",code:812356,scrollViewHeight:0,con:{date:"",timeRange:""},type:"",person:"",phone:"",remark:""}),onLoad(e){this.order_no=e.order_no,this.type=e.type?e.type:"",this.detailType=e.type,this.$nextTick((()=>{this.getNavBarHeight()})),this.initData()},methods:{async initData(){let e=await this.app.getEnum();S({url:"wx/get/order/detail",method:"POST",data:{order_no:this.order_no}}).then((t=>{let a=t.data,l=a.site_detail?a.site_detail:[],s=[];l.forEach((t=>{let l=[];t.time_enum.forEach((t=>{l.push({date:a.reserve_date,timeRange:e[t]})})),s.push({hour:t.time_enum.length,price:t.money,siteName:t.site_name,timeList:l})})),this.gymnasiumInfo.name=a.shop_name,this.gymnasiumInfo.phone=a.shop_phone,this.gymnasiumInfo.location=a.shop_address,this.gymnasiumInfo.latitude=a.latitude,this.gymnasiumInfo.longitude=a.longitude,this.orderTime=a.gmt_creat_order,this.payTime=a.gmt_pay,this.totalPrice=a.money,this.payState=a.status,this.sessionList=s,this.person=a.user_name,this.phone=a.user_phone,this.remark=a.remark}))},getNavBarHeight(){var e=t().windowHeight;let l=this;a().select(".nav-bar").boundingClientRect((t=>{a().select(".bottomBox").boundingClientRect((a=>{l.scrollViewHeight=e-t.height-a.height})).exec()})).exec()},toCall(){l({phoneNumber:this.gymnasiumInfo.phone})},toMap(){s({latitude:this.gymnasiumInfo.latitude,longitude:this.gymnasiumInfo.longitude,scale:18,name:this.gymnasiumInfo.location})},tocopy(){n({data:this.order_no})},cancel(){this.show=!1},confirm(){S({url:"wx/cancel/order",method:"POST",data:{order_no:this.order_no}}).then((()=>{this.payState="C",i({title:"取消成功",icon:"none",duration:2e3,success:()=>{if(this.show=!1,!this.type){this.getOpenerEventChannel().emit("toChangeOrderState",this.order_no,"C")}setTimeout((()=>{this.initData()}),2e3)}})}))},cancelOrder(){this.show=!0},toPay(){S({url:"wx/pay",method:"POST",data:{order_no:this.order_no}}).then((e=>{i({title:"支付成功",icon:"none",duration:2e3,success:()=>{if(!this.type){this.getOpenerEventChannel().emit("toChangeOrderState",this.order_no,"Y")}setTimeout((()=>{this.initData()}),2e3)}})}))},toUse(){o({url:"/pages/reservationInfo/reservationInfo?order_no="+this.order_no})}}},[["render",function(e,t,a,l,s,n){const i=C(b("up-icon"),L),o=C(b("u-navbar"),j),S=C(b("u-modal"),I),B=w,N=d,O=T,E=k;return r(),c(N,{class:"page"},{default:f((()=>[u(o,{class:"nav-bar",title:"add"==s.detailType?"确认订单":"订单详情",safeAreaInsetTop:!0,autoBack:!1,fixed:!1},{left:f((()=>[u(i,{name:"arrow-left",onClick:t[0]||(t[0]=e=>s.app.toBack(s.type?2:1))})])),_:1},8,["title"]),u(S,{show:s.show,title:"提示",content:"确定要取消此订单？",showCancelButton:!0,onConfirm:n.confirm,onCancel:n.cancel},null,8,["show","onConfirm","onCancel"]),u(E,{"scroll-y":!0,class:"w-full",style:x(["height: "+s.scrollViewHeight+"px;",{"padding-top":"14rpx"}])},{default:f((()=>["detail"==s.detailType&&"N"==s.payState?(r(),c(N,{key:0,class:"payStateBox flex align-center justify-center"},{default:f((()=>[u(B,{src:P,mode:"",style:{width:"94rpx",height:"94rpx","margin-right":"20rpx"}}),u(N,{class:"flex flex-direction align-start"},{default:f((()=>[u(N,{class:"waitPayText"},{default:f((()=>[p("等待支付")])),_:1}),u(N,{class:"waitPayTitle"},{default:f((()=>[p("订单已生成，请在15分钟之内支付完成")])),_:1})])),_:1})])),_:1})):m("",!0),u(N,{class:"topBox"},{default:f((()=>[u(N,{class:"topName"},{default:f((()=>[p(h(s.gymnasiumInfo.name),1)])),_:1}),u(N,{class:"flex align-center justify-between",style:{"margin-bottom":"8rpx",height:"38rpx"}},{default:f((()=>[u(N,{class:"commonLeftLabel",onClick:n.toCall},{default:f((()=>[u(O,null,{default:f((()=>[p("电话：")])),_:1}),u(O,{style:{color:"#409EFF"}},{default:f((()=>[p(h(s.gymnasiumInfo.phone),1)])),_:1})])),_:1},8,["onClick"])])),_:1}),u(N,{class:"flex align-center justify-between",style:{height:"38rpx"}},{default:f((()=>[u(N,{class:"commonLeftLabel",onClick:n.toMap},{default:f((()=>[u(O,null,{default:f((()=>[p("地址：")])),_:1}),u(O,{style:{color:"#409EFF"}},{default:f((()=>[p(h(s.gymnasiumInfo.location),1)])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),u(N,{class:"siteList"},{default:f((()=>[u(N,{class:"siteListTitle"},{default:f((()=>[p("预约场次")])),_:1}),u(N,{style:{padding:"0 30rpx"}},{default:f((()=>[(r(!0),_(y,null,g(s.sessionList,((e,t)=>(r(),c(N,{class:"siteListItem",key:t},{default:f((()=>[u(N,{class:"flex align-center justify-between"},{default:f((()=>[u(N,{class:"blackText"},{default:f((()=>[p(h(e.siteName),1)])),_:2},1024),u(N,{class:"grayText"},{default:f((()=>[p(h(e.hour)+"小时",1)])),_:2},1024)])),_:2},1024),u(N,{class:"flex align-center justify-between",style:{"margin-top":"12rpx"}},{default:f((()=>[u(N,{class:"flex flex-direction"},{default:f((()=>[(r(!0),_(y,null,g(e.timeList,((e,t)=>(r(),c(N,{class:"grayText",key:t},{default:f((()=>[u(O,null,{default:f((()=>[p(h(e.date)+" "+h(e.timeRange),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024),u(N,{class:"blackText"},{default:f((()=>[p("￥ "+h(e.price/100),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),u(N,{class:"flex align-center justify-between",style:{padding:"24rpx 20rpx 16rpx"}},{default:f((()=>[u(N,{class:"methodText"},{default:f((()=>[p("小计(共"+h(s.sessionList.length)+"场)",1)])),_:1}),u(N,{class:"priceText"},{default:f((()=>[p("￥"+h(s.totalPrice/100),1)])),_:1})])),_:1})])),_:1}),u(N,{class:"orderInfoBox flex flex-direction justify-center"},{default:f((()=>[u(N,{class:"flex align-center"},{default:f((()=>[u(N,{class:"leftLabel"},{default:f((()=>[p("预约人：")])),_:1}),u(N,{class:"leftLabel flex align-center"},{default:f((()=>[u(O,null,{default:f((()=>[p(h(s.person),1)])),_:1})])),_:1})])),_:1}),u(N,{class:"flex align-center",style:{"margin-top":"12rpx"}},{default:f((()=>[u(N,{class:"leftLabel"},{default:f((()=>[p("手机号码：")])),_:1}),u(N,{class:"leftLabel flex align-center"},{default:f((()=>[u(O,null,{default:f((()=>[p(h(s.phone),1)])),_:1})])),_:1})])),_:1}),u(N,{class:"flex align-center",style:{"margin-top":"12rpx"}},{default:f((()=>[u(N,{class:"leftLabel"},{default:f((()=>[p("备注：")])),_:1}),u(N,{class:"leftLabel flex align-center"},{default:f((()=>[u(O,null,{default:f((()=>[p(h(s.remark),1)])),_:1})])),_:1})])),_:1}),u(N,{class:"flex align-center",style:{"margin-top":"12rpx"}},{default:f((()=>[u(N,{class:"leftLabel"},{default:f((()=>[p("订单编号：")])),_:1}),u(N,{class:"leftLabel flex align-center"},{default:f((()=>[u(O,null,{default:f((()=>[p(h(s.order_no),1)])),_:1}),u(O,{class:"copyText",onClick:n.tocopy},{default:f((()=>[p("复制")])),_:1},8,["onClick"])])),_:1})])),_:1}),u(N,{class:"flex align-center",style:{"margin-top":"12rpx"}},{default:f((()=>[u(N,{class:"leftLabel"},{default:f((()=>[p("下单时间：")])),_:1}),u(N,{class:"leftLabel flex align-center"},{default:f((()=>[u(O,null,{default:f((()=>[p(h(s.orderTime),1)])),_:1})])),_:1})])),_:1}),"Y"==s.payState?(r(),c(N,{key:0,class:"flex align-center",style:{"margin-top":"12rpx"}},{default:f((()=>[u(N,{class:"leftLabel"},{default:f((()=>[p("支付时间：")])),_:1}),u(N,{class:"leftLabel flex align-center"},{default:f((()=>[u(O,null,{default:f((()=>[p(h(s.payTime),1)])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1}),"N"==s.payState?(r(),c(N,{key:1,class:"flex align-center justify-between payMethodBox"},{default:f((()=>[u(N,{class:"methodText"},{default:f((()=>[p("支付方式")])),_:1}),u(N,{class:"flex align-center"},{default:f((()=>[u(B,{src:v,mode:"",style:{width:"36rpx",height:"36rpx","margin-right":"8rpx"}}),u(O,{class:"wechatText"},{default:f((()=>[p("微信支付")])),_:1})])),_:1})])),_:1})):m("",!0),u(N,{class:"bottomBox w-full"},{default:f((()=>[u(N,{class:"flex align-center justify-between h-full"},{default:f((()=>[u(N,{class:"flex align-center"},{default:f((()=>[u(N,{class:"totalText"},{default:f((()=>[p("总计：")])),_:1}),u(N,{class:"priceText"},{default:f((()=>[u(O,null,{default:f((()=>[p("￥")])),_:1}),u(O,null,{default:f((()=>[p(h(s.totalPrice/100),1)])),_:1})])),_:1})])),_:1}),u(N,{class:"flex align-center justify-end"},{default:f((()=>["N"==s.payState||"Y"==s.payState?(r(),c(N,{key:0,class:"cancelBtn",onClick:n.cancelOrder},{default:f((()=>[p("取消订单")])),_:1},8,["onClick"])):m("",!0),"Y"==s.payState?(r(),c(N,{key:1,class:"useBtn",onClick:n.toUse},{default:f((()=>[p("去使用")])),_:1},8,["onClick"])):m("",!0),"N"==s.payState?(r(),c(N,{key:2,class:"payBtn",onClick:n.toPay},{default:f((()=>[p("确认支付")])),_:1},8,["onClick"])):"C"==s.payState?(r(),c(N,{key:3,class:"grayText",style:{"font-size":"32rpx"}},{default:f((()=>[p("已取消")])),_:1})):m("",!0)])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-1252e5bb"]]);export{N as default};
