import{p as e,s as t,D as s,B as a,o as i,c as l,w as r,i as o,b as n,j as d,n as c,e as f,x as h,F as u,r as g,S as _,y as m,g as y,t as p,l as w,k as x,z as k}from"./index-0cdf8aad.js";import{r as C,_ as b}from"./uni-app.es.b79b333a.js";import{_ as L}from"./u-navbar.c8086c10.js";import{_ as j}from"./u-modal.9ca63db5.js";import{_ as P,a as I}from"./u-empty.e9d6edc4.js";import{r as v}from"./request.4f472fa9.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.a67cb4cf.js";import"./u-safe-bottom.196165c8.js";import"./u-badge.d27bb57c.js";const O=T({data:()=>({show:!1,app:e(),titleList:[{name:"全部"},{name:"待支付"},{name:"待使用"}],active:0,waitPayedList:[],waitUsedList:[],order_no:"",orderList:[],scrollViewHeight:"",searchInfo:{pageObj:{firstPage:1,secondPage:1,thirdPage:1},size:10,status:""},triggered:!1,triggered1:!1,triggered2:!1}),onLoad(){this.initData()},onReady(){this.$nextTick((()=>{this.calculate()}))},methods:{onChange(e){switch(this.active=e.index,e.index){case 0:this.searchInfo.status="";break;case 1:this.searchInfo.status="N",0==this.waitPayedList.length&&this.initData();break;case 2:this.searchInfo.status="Y",0==this.waitUsedList.length&&this.initData()}},calculate(){var e=t().windowHeight;this.scrollViewHeight=e-88},toDetail(e){let t=e.currentTarget.dataset.item.order_no;s({url:"/pages/orderDetail/orderDetail?order_no="+t,events:{toChangeOrderState:(e,t)=>{this.dealWithOrderState(e,t)}}})},cancel(){this.show=!1},confirm(){v({url:"wx/cancel/order",method:"POST",data:{order_no:this.order_no}}).then((()=>{a({title:"取消成功",icon:"none",duration:2e3,success:()=>{this.dealWithOrderState(this.order_no,"C"),this.show=!1}})}))},toCancel(e){this.show=!0,this.order_no=e.currentTarget.dataset.item.order_no},toPay(e){v({url:"wx/pay",method:"POST",data:{order_no:e.currentTarget.dataset.item.order_no}}).then((t=>{a({title:"支付成功",icon:"none",duration:2e3,success:()=>{this.dealWithOrderState(e.currentTarget.dataset.item.order_no,"Y")}})}))},toUse(e){s({url:"/pages/reservationInfo/reservationInfo?order_no="+e.currentTarget.dataset.item.order_no})},async initData(e=""){let t=await this.app.getUserInfo();v({url:"wx/get/order/list",method:"POST",data:{user_ouid:t.ouid,page:0==this.active?this.searchInfo.pageObj.firstPage:1==this.active?this.searchInfo.pageObj.secondPage:this.searchInfo.pageObj.thirdPage,size:this.searchInfo.size,status:this.searchInfo.status}}).then((t=>{let s=t.data.list?t.data.list:[];switch(s.forEach((e=>{e.siteNum=e.site_detail?e.site_detail.length:0;let t=0;e.site_detail=e.site_detail?e.site_detail:[],e.site_detail.forEach((e=>{t+=e.time_enum.length})),e.shop_avatar=this.app.globalData.httpUrl+e.shop_avatar,e.hour=t})),s.length<10&&"lower"==e&&a({icon:"none",title:"没有更多数据了"}),this.active){case 0:this.orderList="refresh"==e?s:this.orderList.concat(s),this.triggered=!1;break;case 1:this.waitPayedList="refresh"==e?s:this.waitPayedList.concat(s),this.triggered1=!1;break;case 2:this.waitUsedList="refresh"==e?s:this.waitUsedList.concat(s),this.triggered2=!1}}))},onRefresh(){switch(this.active){case 0:this.searchInfo.pageObj.firstPage=1,this.triggered=!0;break;case 1:this.searchInfo.pageObj.secondPage=1,this.triggered1=!0;break;case 2:this.searchInfo.pageObj.thirdPage=1,this.triggered2=!0}this.initData("refresh")},lower(){switch(this.active){case 0:this.searchInfo.pageObj.firstPage=this.searchInfo.pageObj.firstPage+1;break;case 1:this.searchInfo.pageObj.secondPage=this.searchInfo.pageObj.secondPage+1;break;case 2:this.searchInfo.pageObj.thirdPage=this.searchInfo.pageObj.thirdPage+1}this.initData("lower")},dealWithOrderState(e,t){if(0==this.active){let s=this.orderList.findIndex((t=>t.order_no==e));if(s>-1){if("Y"==t){this.waitUsedList.unshift(this.orderList[s]);let t=this.waitPayedList.findIndex((t=>t.order_no==e));t>-1&&this.waitPayedList.splice(t,1)}else if("N"==this.orderList[s].status){let t=this.waitPayedList.findIndex((t=>t.order_no==e));t>-1&&this.waitPayedList.splice(t,1)}else if("Y"==this.orderList[s].status){let t=this.waitUsedList.findIndex((t=>t.order_no==e));t>-1&&this.waitPayedList.splice(t,1)}this.orderList[s].status=t}}else if(1==this.active){let s=this.waitPayedList.findIndex((t=>t.order_no==e));if(s>-1){this.waitPayedList[s].status=t;let a=this.waitPayedList.splice(s,1);if("Y"==t)this.waitUsedList.unshift(a[0]);else{let t=this.orderList.findIndex((t=>t.order_no==e));t>-1&&(this.orderList[t].status="C")}}}else{let t=this.waitUsedList.findIndex((t=>t.order_no==e));if(t>-1){this.waitUsedList.splice(t,1);let s=this.orderList.findIndex((t=>t.order_no==e));s>-1&&(this.orderList[s].status="C")}}}}},[["render",function(e,t,s,a,v,T){const O=C(g("up-icon"),b),U=C(g("u-navbar"),L),B=C(g("u-modal"),j),D=C(g("u-tabs"),P),N=C(g("u-empty"),I),S=o,R=k,Y=_,F=m("van-dialog");return i(),l(S,{class:"page"},{default:r((()=>[n(U,{class:"nav-bar",title:"我的订单",safeAreaInsetTop:!0,autoBack:!1,fixed:!1},{left:r((()=>[n(O,{name:"arrow-left",onClick:v.app.toBack},null,8,["onClick"])])),_:1}),n(B,{show:v.show,title:"提示",content:"确定要取消此订单？",showCancelButton:!0,onConfirm:T.confirm,onCancel:T.cancel},null,8,["show","onConfirm","onCancel"]),n(D,{class:"tabs",list:v.titleList,onChange:T.onChange,lineColor:"#0077FF",lineWidth:"40"},null,8,["list","onChange"]),0==v.active?(i(),l(Y,{key:0,"scroll-y":!0,class:d(["orderList",0==v.orderList.length?"emptyFlex":""]),style:c("height: "+v.scrollViewHeight+"px;"),"refresher-enabled":"","refresher-triggered":v.triggered,onRefresherrefresh:T.onRefresh,onScrolltolower:T.lower},{default:r((()=>[0==v.orderList.length?(i(),l(N,{key:0,text:"暂无订单"})):(i(),l(S,{key:1},{default:r((()=>[(i(!0),f(u,null,h(v.orderList,((e,t)=>(i(),l(S,{class:"orderItem","data-item":e,key:t,onClick:T.toDetail},{default:r((()=>[n(S,{class:"flex align-center justify-between"},{default:r((()=>[n(S,{class:"orderNoText"},{default:r((()=>[y("订单编号： "+p(e.order_no),1)])),_:2},1024),"N"==e.status?(i(),l(S,{key:0,class:"redText"},{default:r((()=>[y("待支付")])),_:1})):"Y"==e.status?(i(),l(S,{key:1,class:"blueText"},{default:r((()=>[y("待使用")])),_:1})):"C"==e.status?(i(),l(S,{key:2,class:"grayText"},{default:r((()=>[y("已取消")])),_:1})):"U"==e.status?(i(),l(S,{key:3,class:"blueText"},{default:r((()=>[y("已使用")])),_:1})):w("",!0)])),_:2},1024),n(S,{class:"flex align-center justify-between"},{default:r((()=>[n(S,{class:"flex align-center"},{default:r((()=>[n(S,{class:"leftPhoto"},{default:r((()=>[n(R,{src:e.shop_avatar,mode:"",class:"w-full h-full"},null,8,["src"])])),_:2},1024),n(S,{class:"flex flex-direction align-start"},{default:r((()=>[n(S,{class:"gymnasiumName"},{default:r((()=>[y(p(e.shop_name),1)])),_:2},1024),n(S,{class:"reservationInfo"},{default:r((()=>[y("预约场地： "+p(e.siteNum)+"场("+p(e.hour)+"小时） ",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(S,{class:"priceText"},{default:r((()=>[y("￥ "+p(e.money/100),1)])),_:2},1024)])),_:2},1024),"C"==e.status||"U"==e.status?(i(),l(S,{key:0,class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn",onClick:x(T.toDetail,["stop"]),"data-item":e},{default:r((()=>[y("查看详情")])),_:2},1032,["onClick","data-item"])])),_:2},1024)):w("",!0),"N"==e.status?(i(),l(S,{key:1,class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn",onClick:x(T.toCancel,["stop"]),"data-item":e},{default:r((()=>[y("取消订单")])),_:2},1032,["onClick","data-item"]),n(S,{class:"payBtn",onClick:x(T.toPay,["stop"]),"data-item":e},{default:r((()=>[y("去支付")])),_:2},1032,["onClick","data-item"])])),_:2},1024)):w("",!0),"Y"==e.status?(i(),l(S,{key:2,class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn",onClick:x(T.toCancel,["stop"]),"data-item":e},{default:r((()=>[y("取消订单")])),_:2},1032,["onClick","data-item"]),n(S,{class:"useBtn",onClick:x(T.toUse,["stop"]),"data-item":e},{default:r((()=>[y("去使用")])),_:2},1032,["onClick","data-item"])])),_:2},1024)):w("",!0),"finished"==e.status||"refunded"==e.status?(i(),l(S,{key:3,class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn"},{default:r((()=>[y("再次预定")])),_:1})])),_:1})):w("",!0)])),_:2},1032,["data-item","onClick"])))),128))])),_:1}))])),_:1},8,["class","style","refresher-triggered","onRefresherrefresh","onScrolltolower"])):1==v.active?(i(),l(Y,{key:1,"scroll-y":!0,class:d(["orderList",0==v.waitPayedList.length?"emptyFlex":""]),style:c("height: "+v.scrollViewHeight+"px;"),"refresher-triggered":v.triggered1,"refresher-enabled":"",onRefresherrefresh:T.onRefresh,onScrolltolower:T.lower},{default:r((()=>[0==v.waitPayedList.length?(i(),l(N,{key:0,text:"暂无待支付订单"})):(i(),l(S,{key:1},{default:r((()=>[(i(!0),f(u,null,h(v.waitPayedList,((e,t)=>(i(),l(S,{class:"orderItem","data-item":e,key:t,onClick:T.toDetail},{default:r((()=>[n(S,{class:"flex align-center justify-between"},{default:r((()=>[n(S,{class:"orderNoText"},{default:r((()=>[y("订单编号： "+p(e.order_no),1)])),_:2},1024),n(S,{class:"redText"},{default:r((()=>[y("待支付")])),_:1})])),_:2},1024),n(S,{class:"flex align-center justify-between"},{default:r((()=>[n(S,{class:"flex align-center"},{default:r((()=>[n(S,{class:"leftPhoto"},{default:r((()=>[n(R,{src:e.shop_avatar,mode:"",class:"w-full h-full"},null,8,["src"])])),_:2},1024),n(S,{class:"flex flex-direction align-start"},{default:r((()=>[n(S,{class:"gymnasiumName"},{default:r((()=>[y(p(e.shop_name),1)])),_:2},1024),n(S,{class:"reservationInfo"},{default:r((()=>[y("预约场地： "+p(e.siteNum)+"场("+p(e.hour)+"小时） ",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(S,{class:"priceText"},{default:r((()=>[y("￥ "+p(e.money/100),1)])),_:2},1024)])),_:2},1024),"N"==e.status?(i(),l(S,{key:0,class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn",onClick:x(T.toCancel,["stop"]),"data-item":e},{default:r((()=>[y("取消订单")])),_:2},1032,["onClick","data-item"]),n(S,{class:"payBtn",onClick:x(T.toPay,["stop"]),"data-item":e},{default:r((()=>[y("去支付")])),_:2},1032,["onClick","data-item"])])),_:2},1024)):w("",!0),"Y"==e.status?(i(),l(S,{key:1,class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn",onClick:x(T.toCancel,["stop"]),"data-item":e},{default:r((()=>[y("取消订单")])),_:2},1032,["onClick","data-item"]),n(S,{class:"useBtn",onClick:x(T.toUse,["stop"]),"data-item":e},{default:r((()=>[y("去使用")])),_:2},1032,["onClick","data-item"])])),_:2},1024)):w("",!0),"finished"==e.status||"refunded"==e.status?(i(),l(S,{key:2,class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn"},{default:r((()=>[y("再次预定")])),_:1})])),_:1})):w("",!0)])),_:2},1032,["data-item","onClick"])))),128))])),_:1}))])),_:1},8,["style","class","refresher-triggered","onRefresherrefresh","onScrolltolower"])):(i(),l(Y,{key:2,"scroll-y":!0,class:d(["orderList",0==v.waitUsedList.length?"emptyFlex":""]),style:c("height: "+v.scrollViewHeight+"px;"),"refresher-triggered":v.triggered2,"refresher-enabled":"",onRefresherrefresh:T.onRefresh,onScrolltolower:T.lower},{default:r((()=>[0==v.waitUsedList.length?(i(),l(N,{key:0,text:"暂无待使用订单"})):(i(),l(S,{key:1},{default:r((()=>[(i(!0),f(u,null,h(v.waitUsedList,((e,t)=>(i(),l(S,{class:"orderItem",onClick:T.toDetail,"data-item":e,key:t},{default:r((()=>[n(S,{class:"flex align-center justify-between"},{default:r((()=>[n(S,{class:"orderNoText"},{default:r((()=>[y("订单编号： "+p(e.order_no),1)])),_:2},1024),n(S,{class:"blueText"},{default:r((()=>[y("待使用")])),_:1})])),_:2},1024),n(S,{class:"flex align-center justify-between"},{default:r((()=>[n(S,{class:"flex align-center"},{default:r((()=>[n(S,{class:"leftPhoto"},{default:r((()=>[n(R,{src:e.shop_avatar,mode:"",class:"w-full h-full"},null,8,["src"])])),_:2},1024),n(S,{class:"flex flex-direction align-start"},{default:r((()=>[n(S,{class:"gymnasiumName"},{default:r((()=>[y(p(e.shop_name),1)])),_:2},1024),n(S,{class:"reservationInfo"},{default:r((()=>[y("预约场地： "+p(e.siteNum)+"场("+p(e.hour)+"小时） ",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(S,{class:"priceText"},{default:r((()=>[y("￥ "+p(e.money/100),1)])),_:2},1024)])),_:2},1024),n(S,{class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn",onClick:x(T.toCancel,["stop"]),"data-item":e},{default:r((()=>[y("取消订单")])),_:2},1032,["onClick","data-item"]),n(S,{class:"useBtn",onClick:x(T.toUse,["stop"]),"data-item":e},{default:r((()=>[y("去使用")])),_:2},1032,["onClick","data-item"])])),_:2},1024),"finished"==e.status||"refunded"==e.status?(i(),l(S,{key:0,class:"w-full flex align-center",style:{"justify-content":"flex-end"}},{default:r((()=>[n(S,{class:"borderBtn"},{default:r((()=>[y("再次预定")])),_:1})])),_:1})):w("",!0)])),_:2},1032,["onClick","data-item"])))),128))])),_:1}))])),_:1},8,["style","class","refresher-triggered","onRefresherrefresh","onScrolltolower"])),n(F,{id:"van-dialog"})])),_:1})}],["__scopeId","data-v-02e88320"]]);export{O as default};
