import{p as e,s as t,B as s,D as a,o as i,c as r,w as l,i as n,b as o,j as d,n as c,e as h,x as f,F as g,r as u,S as _,g as m,t as p,l as x,z as y}from"./index-0cdf8aad.js";import{r as w,_ as v}from"./uni-app.es.b79b333a.js";import{_ as k}from"./u-navbar.c8086c10.js";import{_ as b,a as L}from"./u-empty.e9d6edc4.js";import{r as I}from"./request.4f472fa9.js";import{_ as j}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-badge.d27bb57c.js";const C=""+new URL("rightArrow-97c67b3d.svg",import.meta.url).href;const U=j({data:()=>({app:e(),titleList:[{name:"全部"},{name:"待使用"},{name:"已使用"}],active:0,waitUsedList:[],alreadyUsedList:[],reservationList:[],scrollViewHeight:"",j:"",con:{date:"",timeRange:""},searchInfo:{pageObj:{firstPage:1,secondPage:1,thirdPage:1},size:10,status:""},triggered:!1,triggered1:!1,triggered2:!1}),onLoad(){this.initData()},onReady(){this.$nextTick((()=>{this.calculate()}))},methods:{onChange(e){switch(this.active=e.index,e.index){case 0:this.searchInfo.status="";break;case 1:this.searchInfo.status="Y",0==this.waitUsedList.length&&this.initData();break;case 2:this.searchInfo.status="U",0==this.alreadyUsedList.length&&this.initData()}},calculate(){var e=t().windowHeight;this.scrollViewHeight=e-88},async initData(e=""){let t=await this.app.getUserInfo();I({url:"wx/get/my/reserve/list",method:"POST",data:{user_ouid:t.ouid,page:0==this.active?this.searchInfo.pageObj.firstPage:1==this.active?this.searchInfo.pageObj.secondPage:this.searchInfo.pageObj.thirdPage,size:this.searchInfo.size,status:this.searchInfo.status}}).then((async t=>{let a=await this.app.getEnum(),i=t.data.list?t.data.list:[];switch(i.forEach((e=>{let t=0,s=0,i=[];e.site_detail=e.site_detail?e.site_detail:[],e.site_detail.forEach((r=>{t+=1,s=r.time_enum.length+s,r.time_enum.forEach((t=>{i.push({date:e.reserve_date,timeRange:a[t]})}))})),e.siteNum=t,e.hour=s,e.timeList=i,e.shop_avatar=this.app.globalData.httpUrl+e.shop_avatar})),i.length<10&&"lower"==e&&s({icon:"none",title:"没有更多数据了"}),this.active){case 0:this.reservationList="refresh"==e?i:this.reservationList.concat(i),this.triggered=!1;break;case 1:this.waitUsedList="refresh"==e?i:this.waitUsedList.concat(i),this.triggered1=!1;break;case 2:this.alreadyUsedList="refresh"==e?i:this.alreadyUsedList.concat(i),this.triggered2=!1}}))},onRefresh(){switch(this.active){case 0:this.searchInfo.pageObj.firstPage=1,this.triggered=!0;break;case 1:this.searchInfo.pageObj.secondPage=1,this.triggered1=!0;break;case 2:this.searchInfo.pageObj.thirdPage=1,this.triggered2=!0}this.initData("refresh")},lower(){switch(this.active){case 0:this.searchInfo.pageObj.firstPage=this.searchInfo.pageObj.firstPage+1;break;case 1:this.searchInfo.pageObj.secondPage=this.searchInfo.pageObj.secondPage+1;break;case 2:this.searchInfo.pageObj.thirdPage=this.searchInfo.pageObj.thirdPage+1}this.initData("lower")},dealWithOrderState(e){if(0==this.active){let t=this.reservationList.findIndex((t=>t.order_no==e));if(t>-1){this.reservationList[t].status="C";let s=this.waitUsedList.findIndex((t=>t.order_no==e));s>-1&&this.waitUsedList.splice(s,1)}}else{let t=this.waitUsedList.findIndex((t=>t.order_no==e));if(t>-1){this.waitUsedList.splice(t,1);let s=this.reservationList.findIndex((t=>t.order_no==e));s>-1&&(this.reservationList[s].status="C")}}},toDetail(e){let t=e.currentTarget.dataset.item.order_no;a({url:"/pages/reservationInfo/reservationInfo?order_no="+t,events:{toChangeReservationState:e=>{this.dealWithOrderState(e)}}})}}},[["render",function(e,t,s,a,I,j){const U=w(u("up-icon"),v),P=w(u("u-navbar"),k),R=w(u("u-tabs"),b),O=w(u("u-empty"),L),D=y,S=n,T=_;return i(),r(S,{class:"page"},{default:l((()=>[o(P,{class:"nav-bar",title:"我的预约",safeAreaInsetTop:!0,autoBack:!1,fixed:!1},{left:l((()=>[o(U,{name:"arrow-left",onClick:I.app.toBack},null,8,["onClick"])])),_:1}),o(R,{class:"tabs",list:I.titleList,onChange:j.onChange,lineColor:"#0077FF",lineWidth:"40"},null,8,["list","onChange"]),0==I.active?(i(),r(T,{key:0,"scroll-y":!0,class:d(["orderList",0==I.reservationList.length?"emptyFlex":""]),style:c("height: "+I.scrollViewHeight+"px;"),"refresher-enabled":"","refresher-triggered":I.triggered,onRefresherrefresh:j.onRefresh,onScrolltolower:j.lower},{default:l((()=>[0==I.reservationList.length?(i(),r(O,{key:0,text:"暂无预约"})):(i(),r(S,{key:1},{default:l((()=>[(i(!0),h(g,null,f(I.reservationList,((e,t)=>(i(),r(S,{class:"orderItem","data-item":e,key:t,onClick:j.toDetail},{default:l((()=>[o(S,{class:"flex align-center justify-between"},{default:l((()=>[o(S,{class:"flex align-center"},{default:l((()=>[o(S,{class:"leftPhoto"},{default:l((()=>[o(D,{class:"w-full h-full",src:e.shop_avatar,mode:""},null,8,["src"])])),_:2},1024),o(S,{class:"flex flex-direction align-start justify-between",style:{height:"132rpx"}},{default:l((()=>[o(S,{class:"gymnasiumName"},{default:l((()=>[m(p(e.shop_name),1)])),_:2},1024),o(S,{class:"flex flex-direction align-start"},{default:l((()=>[o(S,{class:"reservationInfo"},{default:l((()=>[m("预约场地： "+p(e.siteNum)+"场("+p(e.hour)+"小时） ",1)])),_:2},1024),o(S,{class:"flex align-start"},{default:l((()=>[o(S,{class:"reservationInfo"},{default:l((()=>[m("预约时间：")])),_:1}),o(S,{class:"flex flex-direction mutipleLine"},{default:l((()=>[(i(!0),h(g,null,f(e.timeList,((e,t)=>(i(),r(S,{class:"reservationInfo align-center",key:t},{default:l((()=>[m(p(e.date)+" "+p(e.timeRange),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(S,{class:"flex align-center justify-end stateBox"},{default:l((()=>["U"==e.status?(i(),r(S,{key:0,class:"grayText"},{default:l((()=>[m("已使用")])),_:1})):"Y"==e.status?(i(),r(S,{key:1,class:"blueText"},{default:l((()=>[m("待使用")])),_:1})):"N"==e.status?(i(),r(S,{key:2,class:"redText"},{default:l((()=>[m("待支付")])),_:1})):"C"==e.status?(i(),r(S,{key:3,class:"grayText"},{default:l((()=>[m("已取消")])),_:1})):x("",!0)])),_:2},1024),o(S,{class:"detailBox flex align-center",onClick:j.toDetail,"data-item":e},{default:l((()=>[m(" 查看预约 "),o(D,{src:C,style:{width:"28rpx",height:"28rpx"},mode:""})])),_:2},1032,["onClick","data-item"])])),_:2},1032,["data-item","onClick"])))),128))])),_:1}))])),_:1},8,["style","class","refresher-triggered","onRefresherrefresh","onScrolltolower"])):1==I.active?(i(),r(T,{key:1,"scroll-y":!0,class:d(["orderList",0==I.waitUsedList.length?"emptyFlex":""]),style:c("height: "+I.scrollViewHeight+"px;"),"refresher-triggered":I.triggered1,"refresher-enabled":"",onRefresherrefresh:j.onRefresh,onScrolltolower:j.lower},{default:l((()=>[0==I.waitUsedList.length?(i(),r(O,{key:0,text:"暂无待使用预约"})):(i(),r(S,{key:1},{default:l((()=>[(i(!0),h(g,null,f(I.waitUsedList,((e,t)=>(i(),r(S,{class:"orderItem","data-item":e,key:t,onClick:j.toDetail},{default:l((()=>[o(S,{class:"flex align-center justify-between"},{default:l((()=>[o(S,{class:"flex align-center"},{default:l((()=>[o(S,{class:"leftPhoto"},{default:l((()=>[o(D,{class:"w-full h-full",src:e.shop_avatar,mode:""},null,8,["src"])])),_:2},1024),o(S,{class:"flex flex-direction align-start justify-between",style:{height:"132rpx"}},{default:l((()=>[o(S,{class:"gymnasiumName"},{default:l((()=>[m(p(e.shop_name),1)])),_:2},1024),o(S,{class:"flex flex-direction align-start"},{default:l((()=>[o(S,{class:"reservationInfo"},{default:l((()=>[m("预约场地： "+p(e.siteNum)+"场("+p(e.hour)+"小时） ",1)])),_:2},1024),o(S,{class:"flex align-start"},{default:l((()=>[o(S,{class:"reservationInfo"},{default:l((()=>[m("预约时间：")])),_:1}),o(S,{class:"flex flex-direction mutipleLine"},{default:l((()=>[(i(!0),h(g,null,f(e.timeList,((e,t)=>(i(),r(S,{class:"reservationInfo align-center",key:t},{default:l((()=>[m(p(e.date)+" "+p(e.timeRange),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(S,{class:"flex align-center justify-end stateBox"},{default:l((()=>[o(S,{class:"blueText"},{default:l((()=>[m("待使用")])),_:1})])),_:1}),o(S,{class:"detailBox flex align-center",onClick:j.toDetail,"data-item":e},{default:l((()=>[m(" 查看预约 "),o(D,{src:C,style:{width:"28rpx",height:"28rpx"},mode:""})])),_:2},1032,["onClick","data-item"])])),_:2},1032,["data-item","onClick"])))),128))])),_:1}))])),_:1},8,["style","class","refresher-triggered","onRefresherrefresh","onScrolltolower"])):(i(),r(T,{key:2,"scroll-y":!0,class:d(["orderList",0==I.alreadyUsedList.length?"emptyFlex":""]),style:c("height: "+I.scrollViewHeight+"px;"),"refresher-triggered":I.triggered2,"refresher-enabled":"",onRefresherrefresh:j.onRefresh,onScrolltolower:j.lower},{default:l((()=>[0==I.alreadyUsedList.length?(i(),r(O,{key:0,text:"暂无已使用预约"})):(i(),r(S,{key:1},{default:l((()=>[(i(!0),h(g,null,f(I.alreadyUsedList,((e,t)=>(i(),r(S,{class:"orderItem","data-item":e,key:t,onClick:j.toDetail},{default:l((()=>[o(S,{class:"flex align-center justify-between"},{default:l((()=>[o(S,{class:"flex align-center"},{default:l((()=>[o(S,{class:"leftPhoto"},{default:l((()=>[o(D,{class:"w-full h-full",src:e.shop_avatar,mode:""},null,8,["src"])])),_:2},1024),o(S,{class:"flex flex-direction align-start justify-between",style:{height:"132rpx"}},{default:l((()=>[o(S,{class:"gymnasiumName"},{default:l((()=>[m(p(e.shop_name),1)])),_:2},1024),o(S,{class:"flex flex-direction align-start"},{default:l((()=>[o(S,{class:"reservationInfo"},{default:l((()=>[m("预约场地： "+p(e.siteNum)+"场("+p(e.hour)+"小时） ",1)])),_:2},1024),o(S,{class:"reservationInfo"},{default:l((()=>[m("预约时间： "+p(e.reservationTime),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(S,{class:"flex align-center justify-end stateBox"},{default:l((()=>[o(S,{class:"grayText"},{default:l((()=>[m("已使用")])),_:1})])),_:1}),o(S,{class:"detailBox flex align-center",onClick:j.toDetail,"data-item":e},{default:l((()=>[m(" 查看预约 "),o(D,{src:C,style:{width:"28rpx",height:"28rpx"},mode:""})])),_:2},1032,["onClick","data-item"])])),_:2},1032,["data-item","onClick"])))),128))])),_:1}))])),_:1},8,["style","class","refresher-triggered","onRefresherrefresh","onScrolltolower"]))])),_:1})}],["__scopeId","data-v-c535305b"]]);export{U as default};
